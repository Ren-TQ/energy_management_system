# 项目分层架构模式说明

## 📐 项目架构概览

本项目采用了**多种分层架构模式**的组合，实现了前后端分离、职责清晰、易于维护的架构设计。

---

## 🏗️ 一、后端分层架构模式

### 1. MVC架构模式（Model-View-Controller）

**架构类型**: 表现层架构模式

**分层结构**:
```
Controller层 (C) → Service层 (M) → Repository层 (M) → 数据库
                      ↓
                  Entity实体 (M)
                      ↓
                  DTO转换
                      ↓
                  Result<T> (V) → JSON响应
```

**各层职责**:

#### Controller层（控制器层）
- **位置**: `com.campus.energy.controller` 包
- **职责**: 
  - 接收HTTP请求
  - 参数验证和解析
  - 调用Service层
  - 返回JSON响应
- **特点**: 不包含业务逻辑，只负责请求转发

#### Model层（模型层）
包含三个子层：

1. **Service层（业务逻辑层）**
   - **位置**: `com.campus.energy.service` 包
   - **职责**: 处理业务逻辑、事务管理、数据转换

2. **Repository层（数据访问层）**
   - **位置**: `com.campus.energy.repository` 包
   - **职责**: 封装数据访问逻辑、与数据库交互

3. **Entity层（数据模型层）**
   - **位置**: `com.campus.energy.entity` 包
   - **职责**: 定义数据模型、映射数据库表

#### View层（视图层）
- **位置**: `com.campus.energy.dto.common.Result` 和所有DTO类
- **职责**: 统一JSON响应格式、数据传输对象

**代码位置**: 所有Controller、Service、Repository、Entity、DTO类

---

### 2. 三层架构模式（Three-Tier Architecture）

**架构类型**: 经典分层架构

**分层结构**:
```
表现层 (Presentation Layer)
    ↓
业务逻辑层 (Business Logic Layer)
    ↓
数据访问层 (Data Access Layer)
    ↓
数据库层 (Database Layer)
```

**在本项目中的体现**:

#### 第一层：表现层（Presentation Layer）
- **组件**: Controller层
- **职责**: 处理HTTP请求和响应
- **位置**: `controller/` 包

#### 第二层：业务逻辑层（Business Logic Layer）
- **组件**: Service层
- **职责**: 业务规则、数据验证、事务管理
- **位置**: `service/` 包

#### 第三层：数据访问层（Data Access Layer）
- **组件**: Repository层 + Entity层
- **职责**: 数据持久化、数据库交互
- **位置**: `repository/` 包 + `entity/` 包

**代码位置**: 
- 表现层: `DeviceController.java` 等
- 业务层: `DeviceService.java` 等
- 数据层: `DeviceRepository.java`、`Device.java` 等

---

### 3. Repository模式（仓储模式）

**架构类型**: 数据访问层模式

**分层结构**:
```
Service层
    ↓
Repository接口（抽象层）
    ↓
JPA实现（Spring Data JPA）
    ↓
数据库
```

**特点**:
- Repository接口定义数据访问契约
- Spring Data JPA自动实现接口
- 业务层通过Repository访问数据，不直接操作数据库

**代码位置**: `repository/` 包下所有接口

---

### 4. DTO模式（数据传输对象模式）

**架构类型**: 数据传输层模式

**分层结构**:
```
Controller层
    ↓
DTO（数据传输对象）
    ↓
Service层（Entity ↔ DTO转换）
    ↓
Repository层（Entity）
```

**特点**:
- Entity不直接暴露给Controller
- 通过DTO在不同层之间传输数据
- 保护数据模型，控制传输内容

**代码位置**: `dto/` 包下所有DTO类

---

### 5. Service层模式（服务层模式）

**架构类型**: 业务逻辑层模式

**分层结构**:
```
Controller层
    ↓
Service接口/实现（业务逻辑）
    ↓
Repository层
```

**特点**:
- Service层封装业务逻辑
- 一个Service可以调用多个Repository
- 支持事务管理（@Transactional）

**代码位置**: `service/` 包下所有Service类

---

## 🎨 二、前端分层架构模式

### 1. MVVM架构模式（Model-View-ViewModel）

**架构类型**: 前端表现层架构模式

**分层结构**:
```
View (模板) ↔ ViewModel (脚本) ↔ Model (API)
```

**各层职责**:

#### View层（视图层）
- **位置**: 所有`.vue`文件的`<template>`部分
- **职责**: UI展示、用户交互界面

#### ViewModel层（视图模型层）
- **位置**: 所有`.vue`文件的`<script setup>`部分
- **职责**: 业务逻辑、状态管理、数据绑定

#### Model层（模型层）
- **位置**: `src/api/` 目录下的所有API文件
- **职责**: 与后端API通信、数据请求封装

**代码位置**: 所有Vue组件文件

---

### 2. 组件化架构模式（Component Architecture）

**架构类型**: 前端组件架构

**分层结构**:
```
页面组件 (Page Components)
    ↓
布局组件 (Layout Components)
    ↓
基础组件 (Base Components - Element Plus)
```

**特点**:
- 页面级组件: `views/` 目录
- 布局组件: `layout/` 目录
- UI组件库: Element Plus

**代码位置**: 
- 页面: `views/` 包
- 布局: `layout/MainLayout.vue`

---

### 3. 状态管理模式（State Management Pattern）

**架构类型**: 前端状态管理架构

**分层结构**:
```
组件 (Components)
    ↓
Store (Pinia)
    ↓
API (Model层)
```

**特点**:
- 使用Pinia进行状态管理
- 全局状态统一管理
- 单例模式实现

**代码位置**: `stores/user.js`

---

## 🔄 三、跨层架构模式

### 1. 前后端分离架构（Frontend-Backend Separation）

**架构类型**: 系统级架构模式

**分层结构**:
```
前端 (Vue 3) ← HTTP/JSON → 后端 (Spring Boot)
```

**特点**:
- 前端和后端完全独立
- 通过RESTful API通信
- 可以独立部署和扩展

---

### 2. RESTful API架构（REST Architecture）

**架构类型**: Web服务架构模式

**特点**:
- 使用HTTP标准方法（GET、POST、PUT、DELETE）
- 资源导向的URL设计
- 统一响应格式（Result<T>）

**代码位置**: 所有Controller类

---

### 3. 安全层架构（Security Layer）

**架构类型**: 横切关注点架构

**分层结构**:
```
HTTP请求
    ↓
JWT过滤器 (JwtAuthenticationFilter)
    ↓
Spring Security (SecurityConfig)
    ↓
Controller层
```

**特点**:
- 过滤器层: JWT Token验证
- 配置层: Spring Security配置
- 权限控制: 方法级权限（@PreAuthorize）

**代码位置**: 
- `security/JwtAuthenticationFilter.java`
- `config/SecurityConfig.java`

---

### 4. 异常处理层架构（Exception Handling Layer）

**架构类型**: 横切关注点架构

**分层结构**:
```
Controller层
    ↓
业务逻辑层
    ↓
异常抛出
    ↓
GlobalExceptionHandler（全局异常处理）
    ↓
统一错误响应
```

**特点**:
- 全局异常捕获
- 统一错误响应格式
- 异常分类处理

**代码位置**: `exception/GlobalExceptionHandler.java`

---

## 📊 四、完整架构分层图

```
┌─────────────────────────────────────────────────────────┐
│                    前端 (Vue 3)                          │
├─────────────────────────────────────────────────────────┤
│  MVVM架构                                                │
│  ┌──────────┐  ┌──────────────┐  ┌──────────┐          │
│  │   View   │↔│  ViewModel   │↔│   Model  │          │
│  │ (模板)   │  │  (脚本逻辑)  │  │  (API)   │          │
│  └──────────┘  └──────────────┘  └──────────┘          │
│       ↓              ↓              ↓                  │
│  组件化架构      状态管理       API调用层               │
└─────────────────────────────────────────────────────────┘
                        ↓ HTTP/JSON
┌─────────────────────────────────────────────────────────┐
│                 后端 (Spring Boot)                       │
├─────────────────────────────────────────────────────────┤
│  MVC架构                                                 │
│  ┌──────────────┐                                       │
│  │ Controller层 │  ← 表现层                              │
│  │   (C)        │                                       │
│  └──────┬───────┘                                       │
│         ↓                                               │
│  ┌──────────────┐                                       │
│  │  Service层   │  ← 业务逻辑层                          │
│  │   (M)       │                                       │
│  └──────┬───────┘                                       │
│         ↓                                               │
│  ┌──────────────┐                                       │
│  │ Repository层 │  ← 数据访问层                         │
│  │   (M)        │                                       │
│  └──────┬───────┘                                       │
│         ↓                                               │
│  ┌──────────────┐                                       │
│  │  Entity层    │  ← 数据模型层                         │
│  │   (M)        │                                       │
│  └──────┬───────┘                                       │
│         ↓                                               │
│  ┌──────────────┐                                       │
│  │   数据库     │  ← 数据持久层                         │
│  └──────────────┘                                       │
│                                                         │
│  横切关注点:                                            │
│  - 安全层 (JWT过滤器 + Spring Security)                 │
│  - 异常处理层 (GlobalExceptionHandler)                  │
│  - DTO层 (数据传输对象)                                 │
└─────────────────────────────────────────────────────────┘
```

---

## 📋 五、分层架构模式总结表

| 架构模式 | 类型 | 位置 | 主要组件 |
|---------|------|------|---------|
| **MVC架构** | 表现层架构 | 后端 | Controller、Service、Repository、Entity、DTO |
| **三层架构** | 经典分层 | 后端 | 表现层、业务层、数据层 |
| **Repository模式** | 数据访问层 | 后端 | Repository接口 |
| **DTO模式** | 数据传输层 | 后端 | DTO类 |
| **Service层模式** | 业务逻辑层 | 后端 | Service类 |
| **MVVM架构** | 前端表现层 | 前端 | View、ViewModel、Model |
| **组件化架构** | 前端组件 | 前端 | Vue组件 |
| **状态管理模式** | 前端状态 | 前端 | Pinia Store |
| **前后端分离** | 系统架构 | 全栈 | 前端 + 后端 |
| **RESTful API** | Web服务 | 后端 | Controller + Result |
| **安全层架构** | 横切关注点 | 后端 | JWT过滤器 + Security |
| **异常处理层** | 横切关注点 | 后端 | GlobalExceptionHandler |

---

## ✅ 六、架构优势

### 1. 职责分离
- 每层职责明确，易于理解和维护
- 降低层间耦合度

### 2. 可测试性
- 每层可以独立测试
- 易于Mock和单元测试

### 3. 可扩展性
- 易于添加新功能
- 支持水平扩展

### 4. 可维护性
- 代码结构清晰
- 易于定位和修复问题

### 5. 代码复用
- Service层可被多个Controller调用
- 组件可在多个页面复用

---

## 📝 七、代码位置索引

### 后端架构代码位置

| 架构层 | 包路径 | 示例文件 |
|-------|--------|---------|
| **Controller** | `com.campus.energy.controller` | `DeviceController.java` |
| **Service** | `com.campus.energy.service` | `DeviceService.java` |
| **Repository** | `com.campus.energy.repository` | `DeviceRepository.java` |
| **Entity** | `com.campus.energy.entity` | `Device.java` |
| **DTO** | `com.campus.energy.dto` | `DeviceDTO.java` |
| **Security** | `com.campus.energy.security` | `JwtAuthenticationFilter.java` |
| **Exception** | `com.campus.energy.exception` | `GlobalExceptionHandler.java` |

### 前端架构代码位置

| 架构层 | 目录路径 | 示例文件 |
|-------|---------|---------|
| **View** | `src/views/` | `Device.vue` (template部分) |
| **ViewModel** | `src/views/` | `Device.vue` (script部分) |
| **Model** | `src/api/` | `device.js` |
| **Store** | `src/stores/` | `user.js` |
| **Layout** | `src/layout/` | `MainLayout.vue` |

---

## 💡 八、架构设计原则

1. **单一职责原则**: 每层只负责自己的职责
2. **依赖倒置原则**: 依赖抽象（接口），不依赖具体实现
3. **开闭原则**: 对扩展开放，对修改关闭
4. **接口隔离原则**: 使用专门的接口，而不是通用接口
5. **里氏替换原则**: 子类可以替换父类

---

## 🔍 九、如何识别分层架构

### 后端识别方法：
- **Controller**: 查找`@RestController`或`@Controller`注解
- **Service**: 查找`@Service`注解
- **Repository**: 查找`@Repository`注解或继承`JpaRepository`
- **Entity**: 查找`@Entity`注解
- **DTO**: 查找`@Data`和`@Builder`注解的类

### 前端识别方法：
- **View**: 查找`<template>`标签
- **ViewModel**: 查找`<script setup>`标签
- **Model**: 查找`api/`目录下的文件

---

## 📚 相关文档

- MVC架构说明: 见`MVC架构说明.md`
- 设计模式说明: 见代码注释
- Spring MVC文档: https://docs.spring.io/spring-framework/reference/web/webmvc.html
- Vue 3文档: https://vuejs.org/

